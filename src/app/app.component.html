<!-- app.component.html -->
<div class="center">

  <app-start-button 
    *ngIf="showButton"
    (playersChange)="onPlayersChange($event)"
    (selectedPlayerChange)="onSelectedPlayerChange($event)"
    (showButtonChange)="onShowButtonChange($event)">
  </app-start-button>

  <div *ngIf="!showButton" class="search-container">
    <mat-form-field class="search-box">
      <mat-label>Guess the player</mat-label>
      <input matInput 
        [placeholder] ="'GUESS ' + tentative + ' OF 8'" 
        [formControl]="searchBarControl"
        [matAutocomplete]="auto"
        >
    </mat-form-field>
    <mat-autocomplete #auto="matAutocomplete">
      @for (player of filteredPlayers | async; track player) {
        <mat-option (click)="comparePlayer(player)" class="player-option">
          <div class="player-info">
            <span class="name">{{ player.firstName }} {{ player.lastName }}   </span>
            <span class="details">
              <span class="team">
                <img [src]="'assets/teams/' + player.team + '.png'" alt="{{ player.team }}" class="team-logo">
              </span>
              <span class="position">{{ player.position }}</span>
            </span>
          </div>
        </mat-option>
      }
    </mat-autocomplete>

    <div *ngIf="showResults" class="comparison-results-list">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8">
        <ng-container matColumnDef="tentative">
          <th mat-header-cell *matHeaderCellDef> Tentative </th>
          <td mat-cell *matCellDef="let comparison">
        {{ comparison.id }}
          </td>
        </ng-container>

        <ng-container matColumnDef="player">
          <th mat-header-cell *matHeaderCellDef> Player </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.correct}">
        {{ comparison.player.firstName }} {{ comparison.player.lastName }}
          </td>
        </ng-container>

        <ng-container matColumnDef="nationality">
          <th mat-header-cell *matHeaderCellDef> Nationality </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.nationality}">
            <span class="fi fi-{{comparison.player.nationality}}"></span>
          </td>
        </ng-container>

        <ng-container matColumnDef="team">
          <th mat-header-cell *matHeaderCellDef> Team </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.team}">
            <img [src]="'assets/teams/' + comparison.player.team + '.png'" alt="{{ comparison.player.team }}" class="team-logo">        
          </td>
        </ng-container>

        <ng-container matColumnDef="position">
          <th mat-header-cell *matHeaderCellDef> Position </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.position}">
        {{ comparison.player.position }}
          </td>
        </ng-container>

        <ng-container matColumnDef="age">
          <th mat-header-cell *matHeaderCellDef> Age </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.age}">
        {{ comparison.player.age }}
        <span *ngIf="comparison.results.smallerAge">↑</span>
        <span *ngIf="comparison.results.biggerAge">↓</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="number">
          <th mat-header-cell *matHeaderCellDef> Number </th>
          <td mat-cell *matCellDef="let comparison" [ngClass]="{'correct-tile': comparison.results.number}">
        {{ comparison.player.number }}
        <span *ngIf="comparison.results.smallerNumber">↑</span>
        <span *ngIf="comparison.results.biggerNumber">↓</span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;  trackBy: trackByFn"></tr>
      </table>
    </div>
  </div>
</div>